<UserControl x:Class="JapaneseTracker.Views.CustomTitleBar"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes">
    
    <Border x:Name="TitleBarBorder" 
            Height="48"
            materialDesign:ShadowAssist.ShadowDepth="Depth1"
            CornerRadius="8,8,0,0">
        
        <!-- Subtle gradient overlay for Windows 11 feel -->
        <Border.Background>
            <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                <GradientStop Color="{DynamicResource PrimaryColor}" Offset="0"/>
                <GradientStop Color="{DynamicResource PrimaryDarkColor}" Offset="1"/>
            </LinearGradientBrush>
        </Border.Background>
        
        <!-- Title Bar Content -->
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/> <!-- App Icon & Title -->
                <ColumnDefinition Width="Auto"/> <!-- Navigation Breadcrumb -->
                <ColumnDefinition Width="*"/>    <!-- Drag Area -->
                <ColumnDefinition Width="Auto"/> <!-- Action Buttons -->
                <ColumnDefinition Width="Auto"/> <!-- Window Controls -->
            </Grid.ColumnDefinitions>
            
            <!-- App Icon and Title -->
            <StackPanel Grid.Column="0" 
                        Orientation="Horizontal" 
                        VerticalAlignment="Center"
                        Margin="16,0,0,0">
                
                <!-- Japanese App Icon with subtle shadow -->
                <Border Background="{DynamicResource OnPrimaryBrush}"
                        Width="32" 
                        Height="32"
                        CornerRadius="16"
                        VerticalAlignment="Center"
                        Margin="0,0,12,0">
                    <Border.Effect>
                        <DropShadowEffect Color="Black" BlurRadius="4" ShadowDepth="1" Opacity="0.3"/>
                    </Border.Effect>
                    <TextBlock Text="?" 
                               FontSize="18" 
                               FontFamily="{StaticResource JapaneseFontFamily}"
                               Foreground="{DynamicResource PrimaryBrush}"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"
                               FontWeight="Bold"/>
                </Border>
                
                <!-- App Title -->
                <StackPanel VerticalAlignment="Center">
                    <TextBlock Text="{Binding Title, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                               FontSize="14" 
                               FontWeight="SemiBold"
                               Foreground="{DynamicResource OnPrimaryBrush}"
                               LineHeight="16"/>
                    <TextBlock Text="{Binding Subtitle, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                               FontSize="10" 
                               FontFamily="{StaticResource JapaneseFontFamily}"
                               Foreground="{DynamicResource OnPrimaryBrush}"
                               Opacity="0.8"
                               LineHeight="12"/>
                </StackPanel>
            </StackPanel>
            
            <!-- Navigation Breadcrumb -->
            <StackPanel Grid.Column="1" 
                        Orientation="Horizontal" 
                        VerticalAlignment="Center"
                        Margin="24,0,0,0"
                        x:Name="BreadcrumbPanel">
                
                <!-- Separator -->
                <Rectangle Width="1" 
                          Height="24" 
                          Fill="{DynamicResource OnPrimaryBrush}" 
                          Opacity="0.3"
                          Margin="0,0,16,0"/>
                
                <!-- Current Section -->
                <StackPanel Orientation="Horizontal">
                    <materialDesign:PackIcon Kind="ChevronRight" 
                                           Width="12" 
                                           Height="12"
                                           Foreground="{DynamicResource OnPrimaryBrush}"
                                           Opacity="0.6"
                                           VerticalAlignment="Center"
                                           Margin="0,0,8,0"/>
                    
                    <TextBlock Text="{Binding CurrentSection, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                               FontSize="13" 
                               FontWeight="Medium"
                               Foreground="{DynamicResource OnPrimaryBrush}"
                               VerticalAlignment="Center"/>
                </StackPanel>
            </StackPanel>
            
            <!-- Drag Area (invisible but handles window dragging) -->
            <Border Grid.Column="2" 
                    Background="Transparent"
                    x:Name="DragArea"/>
            
            <!-- Action Buttons -->
            <StackPanel Grid.Column="3" 
                        Orientation="Horizontal"
                        VerticalAlignment="Center"
                        Margin="0,0,8,0">
                
                <!-- Search Button -->
                <Button Style="{StaticResource TitleBarActionButton}"
                        ToolTip="Search (Ctrl+F)"
                        x:Name="SearchButton">
                    <materialDesign:PackIcon Kind="Search" 
                                           Width="18" 
                                           Height="18"
                                           Foreground="{DynamicResource OnPrimaryBrush}"/>
                </Button>
                
                <!-- Notifications Button with Badge -->
                <Grid>
                    <Button Style="{StaticResource TitleBarActionButton}"
                            ToolTip="Notifications"
                            x:Name="NotificationsButton">
                        <materialDesign:PackIcon Kind="Bell" 
                                               Width="18" 
                                               Height="18"
                                               Foreground="{DynamicResource OnPrimaryBrush}"/>
                    </Button>
                    
                    <!-- Notification Badge -->
                    <Border Background="{StaticResource ErrorBrush}"
                            Width="16"
                            Height="16"
                            CornerRadius="8"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Top"
                            Margin="0,-4,-4,0"
                            x:Name="NotificationBadge"
                            Visibility="Collapsed">
                        <TextBlock Text="{Binding NotificationCount, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                   FontSize="10"
                                   FontWeight="Bold"
                                   Foreground="White"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"/>
                    </Border>
                </Grid>
                
                <!-- User Profile Button -->
                <Button Style="{StaticResource TitleBarActionButton}"
                        ToolTip="Profile Settings"
                        x:Name="ProfileButton">
                    <materialDesign:PackIcon Kind="Account" 
                                           Width="18" 
                                           Height="18"
                                           Foreground="{DynamicResource OnPrimaryBrush}"/>
                </Button>
                
                <!-- Separator -->
                <Rectangle Width="1" 
                          Height="24" 
                          Fill="{DynamicResource OnPrimaryBrush}" 
                          Opacity="0.3"
                          Margin="8,0"/>
            </StackPanel>
            
            <!-- Windows 11 Style Window Controls -->
            <StackPanel Grid.Column="4" 
                        Orientation="Horizontal"
                        VerticalAlignment="Stretch">
                
                <!-- Minimize Button -->
                <Button x:Name="MinimizeButton"
                        Style="{StaticResource Windows11WindowControlButton}"
                        Width="46" 
                        Height="48"
                        ToolTip="Minimize">
                    <materialDesign:PackIcon Kind="WindowMinimize" 
                                           Width="16" 
                                           Height="16"
                                           Foreground="{DynamicResource OnPrimaryBrush}"/>
                </Button>
                
                <!-- Maximize/Restore Button -->
                <Button x:Name="MaximizeRestoreButton"
                        Style="{StaticResource Windows11WindowControlButton}"
                        Width="46" 
                        Height="48"
                        ToolTip="Maximize">
                    <materialDesign:PackIcon x:Name="MaximizeIcon"
                                           Kind="WindowMaximize" 
                                           Width="16" 
                                           Height="16"
                                           Foreground="{DynamicResource OnPrimaryBrush}"/>
                </Button>
                
                <!-- Close Button -->
                <Button x:Name="CloseButton"
                        Style="{StaticResource Windows11CloseButton}"
                        Width="46" 
                        Height="48"
                        ToolTip="Close">
                    <materialDesign:PackIcon Kind="Close" 
                                           Width="16" 
                                           Height="16"
                                           Foreground="{DynamicResource OnPrimaryBrush}"/>
                </Button>
            </StackPanel>
        </Grid>
    </Border>
</UserControl>