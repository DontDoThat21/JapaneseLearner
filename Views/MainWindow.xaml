<Window x:Class="JapaneseTracker.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:views="clr-namespace:JapaneseTracker.Views"
        xmlns:viewModels="clr-namespace:JapaneseTracker.ViewModels"
        xmlns:converters="clr-namespace:JapaneseTracker.Converters"
        Title="Japanese Learning Tracker" 
        Height="900" 
        Width="1400"
        WindowStartupLocation="CenterScreen"
        WindowStyle="None"
        AllowsTransparency="False"
        ResizeMode="CanResize"
        Background="{DynamicResource MaterialDesignPaper}"
        FontFamily="{DynamicResource MaterialDesignFont}"
        TextElement.Foreground="{DynamicResource MaterialDesignBody}"
        TextElement.FontWeight="Regular"
        TextElement.FontSize="13"
        TextOptions.TextFormattingMode="Ideal"
        TextOptions.TextRenderingMode="Auto">
    
    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="48"
                      CornerRadius="0"
                      GlassFrameThickness="0"
                      NonClientFrameEdges="None"
                      ResizeBorderThickness="5"
                      UseAeroCaptionButtons="False" />
    </WindowChrome.WindowChrome>
    
    <Window.Resources>
        <converters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <converters:ViewVisibilityConverter x:Key="ViewVisibilityConverter"/>
        <converters:ViewNotImplementedConverter x:Key="ViewNotImplementedConverter"/>
        <converters:MenuIconConverter x:Key="MenuIconConverter"/>
    </Window.Resources>
    
    <!-- Keyboard Shortcuts for Navigation and Reviews -->
    <Window.InputBindings>
        <KeyBinding Key="F1" Modifiers="Shift" Command="{Binding ShowKeyboardShortcutsCommand}" />
        <KeyBinding Key="F1" Command="{Binding NavigateCommand}" CommandParameter="Dashboard" />
        <KeyBinding Key="F2" Command="{Binding NavigateCommand}" CommandParameter="Kanji" />
        <KeyBinding Key="F3" Command="{Binding NavigateCommand}" CommandParameter="Vocabulary" />
        <KeyBinding Key="F4" Command="{Binding NavigateCommand}" CommandParameter="Grammar" />
        <KeyBinding Key="F5" Command="{Binding NavigateCommand}" CommandParameter="Practice" />
        <KeyBinding Key="F6" Command="{Binding NavigateCommand}" CommandParameter="JLPT Progress" />
        <KeyBinding Key="F12" Command="{Binding LoadDataCommand}" />
        <KeyBinding Key="Escape" Command="{Binding NavigateCommand}" CommandParameter="Dashboard" />
        
        <!-- Phase 5: Import/Export shortcuts -->
        <KeyBinding Key="E" Modifiers="Ctrl" Command="{Binding ExportDataCommand}" CommandParameter="csv_kanji" />
        <KeyBinding Key="I" Modifiers="Ctrl" Command="{Binding ImportDataCommand}" CommandParameter="csv_kanji" />
        <KeyBinding Key="E" Modifiers="Ctrl+Shift" Command="{Binding ExportDataCommand}" CommandParameter="anki_kanji" />
        <KeyBinding Key="B" Modifiers="Ctrl" Command="{Binding ExportDataCommand}" CommandParameter="json_backup" />
        <KeyBinding Key="P" Modifiers="Ctrl+Shift" Command="{Binding ShowPerformanceReportCommand}" />
    </Window.InputBindings>
    
    <!-- Main Container with Custom Title Bar -->
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Custom Title Bar -->
            <RowDefinition Height="*"/>    <!-- Main Content -->
        </Grid.RowDefinitions>
        
        <!-- Custom Title Bar -->
        <views:CustomTitleBar x:Name="CustomTitleBar" 
                              Grid.Row="0" 
                              CurrentSection="{Binding SelectedView, RelativeSource={RelativeSource AncestorType=Window}}"
                              WindowChrome.IsHitTestVisibleInChrome="True"/>
        
        <!-- Main Application Content -->
        <Border Grid.Row="1" 
                Background="{DynamicResource BackgroundBrush}"
                CornerRadius="0,0,8,8">
            <materialDesign:DialogHost Identifier="MainDialogHost">
                <materialDesign:DrawerHost IsLeftDrawerOpen="{Binding ElementName=MenuToggleButton, Path=IsChecked}">
                    <materialDesign:DrawerHost.LeftDrawerContent>
                        <DockPanel MinWidth="220">
                            <!-- Header -->
                            <Border DockPanel.Dock="Top" 
                                    Background="{StaticResource PrimaryBrush}" 
                                    Height="80">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <!-- Japanese Symbol -->
                                    <TextBlock Grid.Column="0" 
                                               Text="漢" 
                                               FontSize="32" 
                                               FontFamily="{StaticResource JapaneseFontFamily}"
                                               Foreground="{StaticResource OnPrimaryBrush}"
                                               VerticalAlignment="Center"
                                               HorizontalAlignment="Center"
                                               Margin="16,0,8,0"/>
                                    
                                    <!-- App Title -->
                                    <StackPanel Grid.Column="1" 
                                                VerticalAlignment="Center" 
                                                Margin="8,0,16,0">
                                        <TextBlock Text="Japanese Tracker" 
                                                   FontSize="16" 
                                                   FontWeight="Bold"
                                                   Foreground="{StaticResource OnPrimaryBrush}"/>
                                        <TextBlock Text="日本語学習" 
                                                   FontSize="12" 
                                                   FontFamily="{StaticResource JapaneseFontFamily}"
                                                   Foreground="{StaticResource OnPrimaryBrush}"
                                                   Opacity="0.8"/>
                                    </StackPanel>
                                </Grid>
                            </Border>
                            
                            <!-- User Info -->
                            <Border DockPanel.Dock="Top" 
                                    Background="{StaticResource SurfaceBrush}" 
                                    Padding="16,12">
                                <StackPanel>
                                    <TextBlock Text="{Binding CurrentUser.Username, FallbackValue='Guest User'}" 
                                               FontWeight="SemiBold" 
                                               FontSize="14"
                                               Foreground="{StaticResource OnSurfaceBrush}"/>
                                    <TextBlock Text="{Binding CurrentUser.CurrentJLPTLevel, StringFormat='Current Level: {0}', FallbackValue='Level: N5'}" 
                                               FontSize="12" 
                                               Opacity="0.8"
                                               Foreground="{StaticResource OnSurfaceBrush}"/>
                                    <TextBlock Text="{Binding CurrentUser.StudyStreak, StringFormat='Study Streak: {0} days', FallbackValue='Streak: 0 days'}" 
                                               FontSize="12" 
                                               Opacity="0.8"
                                               Foreground="{StaticResource OnSurfaceBrush}"/>
                                </StackPanel>
                            </Border>
                            
                            <!-- Navigation Menu -->
                            <ListBox ItemsSource="{Binding NavigationItems}"
                                     SelectedItem="{Binding SelectedView}"
                                     Style="{StaticResource MaterialDesignNavigationPrimaryListBox}">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Height="48">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            
                                            <!-- Icons for each menu item -->
                                            <materialDesign:PackIcon Grid.Column="0" 
                                                                   Kind="{Binding Converter={StaticResource MenuIconConverter}}"
                                                                   Width="24" 
                                                                   Height="24"
                                                                   Margin="16,0,16,0"
                                                                   VerticalAlignment="Center"/>
                                        
                                            <TextBlock Grid.Column="1" 
                                                       Text="{Binding}" 
                                                       VerticalAlignment="Center"
                                                       FontSize="14"/>
                                        </Grid>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </DockPanel>
                    </materialDesign:DrawerHost.LeftDrawerContent>
                    
                    <!-- Main Content -->
                    <DockPanel>
                        <!-- Top App Bar -->
                        <materialDesign:ColorZone Padding="16" 
                                                materialDesign:ShadowAssist.ShadowDepth="Depth2" 
                                                DockPanel.Dock="Top" 
                                                Mode="PrimaryMid">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <!-- Menu Toggle -->
                                <ToggleButton Grid.Column="0" 
                                              x:Name="MenuToggleButton"
                                              Style="{StaticResource MaterialDesignHamburgerToggleButton}"
                                              IsChecked="True"/>
                                
                                <!-- Page Title -->
                                <TextBlock Grid.Column="1" 
                                           Text="{Binding SelectedView, StringFormat='Japanese Learning - {0}'}" 
                                           FontSize="18" 
                                           FontWeight="Medium"
                                           VerticalAlignment="Center"
                                           Margin="24,0,0,0"/>
                                
                                <!-- Toolbar Actions -->
                                <StackPanel Grid.Column="2" 
                                            Orientation="Horizontal">
                                
                                    <!-- Refresh Button -->
                                    <Button Command="{Binding LoadDataCommand}"
                                            Style="{StaticResource MaterialDesignToolButton}"
                                            ToolTip="Refresh Data">
                                        <materialDesign:PackIcon Kind="Refresh" />
                                    </Button>
                                    
                                    <!-- Settings Button -->
                                    <Button Style="{StaticResource MaterialDesignToolButton}"
                                            ToolTip="Settings">
                                        <materialDesign:PackIcon Kind="Settings" />
                                    </Button>
                                    
                                </StackPanel>
                            </Grid>
                        </materialDesign:ColorZone>
                        
                        <!-- Content Area -->
                        <Grid Background="{StaticResource BackgroundBrush}">
                            <!-- Loading Indicator -->
                            <materialDesign:Card Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}"
                                               Background="{StaticResource SurfaceBrush}"
                                               Padding="48"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center">
                                <StackPanel Orientation="Horizontal">
                                    <ProgressBar Style="{StaticResource MaterialDesignCircularProgressBar}"
                                               Value="0"
                                               IsIndeterminate="True"
                                               Width="32"
                                               Height="32"/>
                                    <TextBlock Text="Loading..." 
                                             VerticalAlignment="Center" 
                                             Margin="16,0,0,0"
                                             Foreground="{StaticResource OnSurfaceBrush}"/>
                                </StackPanel>
                            </materialDesign:Card>
                            
                            <!-- Content Views -->
                            <Grid Visibility="{Binding SelectedView, Converter={StaticResource ViewVisibilityConverter}, ConverterParameter='Dashboard'}">
                                <views:DashboardView/>
                            </Grid>
                            
                            <Grid Visibility="{Binding SelectedView, Converter={StaticResource ViewVisibilityConverter}, ConverterParameter='Kanji'}">
                                <views:KanjiView/>
                            </Grid>
                            
                            <Grid Visibility="{Binding SelectedView, Converter={StaticResource ViewVisibilityConverter}, ConverterParameter='Vocabulary'}">
                                <views:VocabularyView/>
                            </Grid>
                            
                            <Grid Visibility="{Binding SelectedView, Converter={StaticResource ViewVisibilityConverter}, ConverterParameter='Grammar'}">
                                <views:GrammarView/>
                            </Grid>
                            
                            <Grid Visibility="{Binding SelectedView, Converter={StaticResource ViewVisibilityConverter}, ConverterParameter='Practice'}">
                                <views:PracticeView/>
                            </Grid>
                            
                            <!-- Placeholder for other views -->
                            <StackPanel HorizontalAlignment="Center" 
                                      VerticalAlignment="Center"
                                      Opacity="0.6"
                                      Visibility="{Binding SelectedView, Converter={StaticResource ViewNotImplementedConverter}}">
                                <materialDesign:PackIcon Kind="Construction" 
                                                       Width="64" 
                                                       Height="64" 
                                                       HorizontalAlignment="Center"
                                                       Foreground="{StaticResource OnBackgroundBrush}"/>
                                <TextBlock Text="{Binding SelectedView, StringFormat='Coming Soon: {0} View'}"
                                         FontSize="24"
                                         FontWeight="Light"
                                         HorizontalAlignment="Center"
                                         Margin="0,16,0,0"
                                         Foreground="{StaticResource OnBackgroundBrush}"/>
                                <TextBlock Text="This feature is under development"
                                         FontSize="16"
                                         HorizontalAlignment="Center"
                                         Opacity="0.8"
                                         Margin="0,8,0,0"
                                         Foreground="{StaticResource OnBackgroundBrush}"/>
                            </StackPanel>
                        </Grid>
                    </DockPanel>
                </materialDesign:DrawerHost>
            </materialDesign:DialogHost>
        </Border>
    </Grid>
</Window>
